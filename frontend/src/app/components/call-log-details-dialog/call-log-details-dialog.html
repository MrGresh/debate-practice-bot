<div class="dialog-card">
  <header class="dialog-header">
    <h2>Call Log Details <code>({{ callLog?.callId | slice:0:8 }}...)</code></h2>
    <button (click)="close.emit()" class="close-button" aria-label="Close dialog">√ó</button>
  </header>

  <nav class="tabs-nav-dialog">
    <button 
      [ngClass]="{'active-tab': activeTab === 'metaData'}" 
      (click)="setActiveTab('metaData')">
      üìã Metadata
    </button>
    <button 
      [ngClass]="{'active-tab': activeTab === 'callReport'}" 
      (click)="setActiveTab('callReport')"
      [disabled]="!callReport">
      üìä Call Report
    </button>
    <button 
      [ngClass]="{'active-tab': activeTab === 'transcript'}" 
      (click)="setActiveTab('transcript')"
      [disabled]="!transcript || transcript.length === 0">
      üí¨ Transcript
    </button>
  </nav>

  <!-- Metadata Tab -->
  <section *ngIf="activeTab === 'metaData'" class="tab-content-dialog">
    <div class="data-grid">
      <div class="data-item">
        <span class="label">Call ID</span>
        <span>{{ callLog?.callId }}</span>
      </div>
      <div class="data-item">
        <span class="label">Status</span>
        <span 
          class="status-chip"
          [ngClass]="{
            'status-started': callLog?.status === 'STARTED',
            'status-evaluation': callLog?.status === 'UNDER_EVALUATION',
            'status-evaluated': callLog?.status === 'EVALUATED'
          }">
          {{ callLog?.status }}
        </span>
      </div>
      <div class="data-item">
        <span class="label">Started At</span>
        <span>{{ callLog?.startedAt | date:'medium' }}</span>
      </div>
      <div class="data-item">
        <span class="label">Ended At</span>
        <span>{{ callLog?.endedAt | date:'medium' }}</span>
      </div>
      <div class="data-item">
        <span class="label">Duration</span>
        <span>{{ callLog?.durationMinutes }} minutes</span>
      </div>
      <div class="data-item">
        <span class="label">Cost</span>
        <span>${{ callLog?.cost | number:'1.2-2' }}</span>
      </div>
      <div class="data-item full-row">
        <span class="label">Recording URL</span>
        <a *ngIf="callLog?.recordingUrl" [href]="callLog?.recordingUrl" target="_blank" rel="noopener">
          üéß Listen to Recording
        </a>
        <span *ngIf="!callLog?.recordingUrl">N/A</span>
      </div>
      <div class="data-item full-row">
        <span class="label">Summary</span>
        <p>{{ callLog?.summary || 'No summary available.' }}</p>
      </div>
    </div>
  </section>

  <!-- Call Report Tab -->
  <section *ngIf="activeTab === 'callReport'" class="tab-content-dialog">
    <div *ngIf="callReport" class="report-section">
      <h3>Key Scores</h3>
      <div class="data-grid score-grid">
        <div class="data-item">
          <span class="label">Coherence</span>
          <span>{{ callReport.coherence_score }}/10</span>
        </div>
        <div class="data-item">
          <span class="label">Overall</span>
          <span>{{ callReport.overall_debate_score }}/10</span>
        </div>
        <div class="data-item">
          <span class="label">Clarity</span>
          <span>{{ callReport.argument_clarity_score }}/10</span>
        </div>
        <div class="data-item">
          <span class="label">Evidence</span>
          <span>{{ callReport.evidence_quality_score }}/10</span>
        </div>
      </div>

      <h3>Evaluations</h3>
      <div class="evaluation-item">
        <span class="label">Emotional Tone</span>
        <span>{{ callReport.emotional_tone_evaluation || 'N/A' }}</span>
      </div>
      <div class="evaluation-item">
        <span class="label">Pacing</span>
        <span>{{ callReport.pacing_evaluation || 'N/A' }}</span>
      </div>
      
      <h3>Strengths & Weaknesses</h3>
      <div class="evaluation-item">
        <span class="label">üí™ Primary Strength</span>
        <p>{{ callReport.primary_strength || 'N/A' }}</p>
      </div>
      <div class="evaluation-item">
        <span class="label">‚ö° Primary Weakness</span>
        <p>{{ callReport.primary_weakness || 'N/A' }}</p>
      </div>

      <h3 *ngIf="callReport.fallacies && callReport.fallacies.count! > 0">
        Fallacies Detected ({{ callReport.fallacies.count }})
      </h3>
      <ul *ngIf="callReport.fallacies && callReport.fallacies.count! > 0" class="fallacy-list">
        <li *ngFor="let fallacy of callReport.fallacies.list">{{ fallacy }}</li>
      </ul>
    </div>

    <div *ngIf="!callReport" class="empty-state">
      <p>üì≠ Call report is not available for this log.</p>
    </div>
  </section>

  <!-- Transcript Tab -->
  <section *ngIf="activeTab === 'transcript'" class="tab-content-dialog">
    <div *ngIf="transcript && transcript.length > 0" class="transcript-list">
      <article 
        *ngFor="let entry of filteredTranscript" 
        class="transcript-entry" 
        [ngClass]="{'user-message': entry.role === 'user', 'assistant-message': entry.role === 'assistant'}">
        <div class="message-header">
          <span class="role">{{ entry.role === 'user' ? 'üë§ You' : 'ü§ñ AI' }}</span>
          <span class="time">
            {{ formatTime(entry.time) }} - {{ formatTime(entry.endTime) }}
          </span>
          <span class="duration-chip">
            ‚è±Ô∏è {{ getDurationSeconds(entry.endTime, entry.time) }}s
          </span>
        </div>
        <p class="message-content">{{ entry.message }}</p>
      </article>
    </div>

    <div *ngIf="!transcript || transcript.length === 0" class="empty-state">
      <p>üì≠ Transcript is not available for this call.</p>
    </div>
  </section>
</div>
