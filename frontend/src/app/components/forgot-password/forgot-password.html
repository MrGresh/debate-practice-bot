<div class="forgot-password-container">
  <div class="card">
    <h2 class="title">{{ step === 'send-otp' ? 'Forgot Password?' : 'Reset Your Password' }}</h2>
    <p class="subtitle">
      <span *ngIf="step === 'send-otp'">Enter your email to receive a password reset code.</span>
      <span *ngIf="step === 'reset-password'">Enter the 6-digit code sent to <strong>{{ resetEmail }}</strong> and your new password.</span>
    </p>

    <form *ngIf="step === 'send-otp'" [formGroup]="sendOtpForm" (ngSubmit)="onSubmitSendOtp()">
      
      <div class="form-group">
        <label for="email">Email Address</label>
        <input 
          id="email" 
          type="email" 
          formControlName="email" 
          [class.is-invalid]="sendF['email'].invalid && (sendF['email'].dirty || sendF['email'].touched)"
          placeholder="your.email@example.com"
        />
        <div *ngIf="sendF['email'].invalid && (sendF['email'].dirty || sendF['email'].touched)" class="error-message">
          <span *ngIf="sendF['email'].errors?.['required']">Email is required.</span>
          <span *ngIf="sendF['email'].errors?.['email']">Enter a valid email address.</span>
        </div>
      </div>

      <button type="submit" [disabled]="sendOtpForm.invalid || isLoading" class="btn-primary">
        <span *ngIf="!isLoading">Send Reset Code</span>
        <span *ngIf="isLoading">Sending...</span>
      </button>
      
      <p class="login-text">
        <a [routerLink]="['/login']" class="link">Back to Login</a>
      </p>
    </form>

    <form *ngIf="step === 'reset-password'" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmitResetPassword()">
      
      <div class="form-group">
        <label for="otp">Verification Code (OTP)</label>
        <input 
          id="otp" 
          type="text" 
          formControlName="otp" 
          maxlength="6"
          [class.is-invalid]="resetF['otp'].invalid && (resetF['otp'].dirty || resetF['otp'].touched)"
          placeholder="Enter 6-digit code"
        />
        <div *ngIf="resetF['otp'].invalid && (resetF['otp'].dirty || resetF['otp'].touched)" class="error-message">
          <span *ngIf="resetF['otp'].errors?.['required']">OTP is required.</span>
          <span *ngIf="resetF['otp'].errors?.['pattern']">OTP must be a 6-digit number.</span>
        </div>
      </div>

      <div class="form-group input-with-icon">
        <label for="newPassword">New Password</label>
        <input 
          id="newPassword" 
          [type]="isNewPasswordVisible ? 'text' : 'password'" 
          formControlName="newPassword" 
          [class.is-invalid]="resetF['newPassword'].invalid && (resetF['newPassword'].dirty || resetF['newPassword'].touched)"
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
        />
        <button 
          type="button" 
          class="password-toggle" 
          (click)="togglePasswordVisibility('newPassword')" 
          title="Toggle password visibility">
          {{ isNewPasswordVisible ? 'ğŸ‘ï¸' : 'ğŸ”’' }}
        </button>
        <div *ngIf="resetF['newPassword'].invalid && (resetF['newPassword'].dirty || resetF['newPassword'].touched)" class="error-message">
          <span *ngIf="resetF['newPassword'].errors?.['required']">New password is required.</span>
          <span *ngIf="resetF['newPassword'].errors?.['minlength']">Password must be at least 6 characters.</span>
        </div>
      </div>

      <div class="form-group input-with-icon">
        <label for="confirmNewPassword">Confirm New Password</label>
        <input 
          id="confirmNewPassword" 
          [type]="isConfirmNewPasswordVisible ? 'text' : 'password'" 
          formControlName="confirmNewPassword" 
          [class.is-invalid]="
            (resetF['confirmNewPassword'].invalid && (resetF['confirmNewPassword'].dirty || resetF['confirmNewPassword'].touched)) || 
            (resetPasswordForm.errors?.['passwordsNotMatching'] && resetF['confirmNewPassword'].value)
          "
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
        />
        <button 
          type="button" 
          class="password-toggle" 
          (click)="togglePasswordVisibility('confirmNewPassword')" 
          title="Toggle password visibility">
          {{ isConfirmNewPasswordVisible ? 'ğŸ‘ï¸' : 'ğŸ”’' }}
        </button>
        <div *ngIf="resetF['confirmNewPassword'].invalid && (resetF['confirmNewPassword'].dirty || resetF['confirmNewPassword'].touched)" class="error-message">
            <span *ngIf="resetF['confirmNewPassword'].errors?.['required']">Confirmation is required.</span>
        </div>
        <div *ngIf="resetPasswordForm.errors?.['passwordsNotMatching'] && resetF['confirmNewPassword'].value && (resetF['confirmNewPassword'].dirty || resetF['confirmNewPassword'].touched)" class="error-message">
            <span>Passwords do not match.</span>
        </div>
      </div>

      <button type="submit" [disabled]="resetPasswordForm.invalid || isLoading" class="btn-primary">
        <span *ngIf="!isLoading">Reset Password</span>
        <span *ngIf="isLoading">Resetting...</span>
      </button>

      <p class="login-text">
        <a [routerLink]="['/login']" class="link">Back to Login</a>
      </p>
    </form>
  </div>
</div>